â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘           ğŸ”§ FIX BOOKINGS PAGE - DO THIS NOW (2 MIN)         â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ERROR: "Edge Function returned a non-2xx status code"
CAUSE: Database migrations not run yet
SOLUTION: Run the SQL below in Supabase

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ STEP 1: Open Supabase SQL Editor

   Click this link:
   https://supabase.com/dashboard/project/zxbfygofxxmfivddwdqt/sql/new

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ STEP 2: Copy the SQL Script

   Open the file: QUICK_FIX_RUN_NOW.sql
   
   OR copy this:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                         â”‚
   â”‚  -- Add related_id column                              â”‚
   â”‚  ALTER TABLE notifications                             â”‚
   â”‚  ADD COLUMN IF NOT EXISTS related_id UUID;             â”‚
   â”‚                                                         â”‚
   â”‚  -- Create update_booking_status function              â”‚
   â”‚  CREATE OR REPLACE FUNCTION update_booking_status(     â”‚
   â”‚    p_booking_id UUID,                                  â”‚
   â”‚    p_new_status TEXT,                                  â”‚
   â”‚    p_cancellation_reason TEXT DEFAULT NULL             â”‚
   â”‚  )                                                      â”‚
   â”‚  RETURNS BOOLEAN                                        â”‚
   â”‚  LANGUAGE plpgsql                                       â”‚
   â”‚  SECURITY DEFINER                                       â”‚
   â”‚  AS $$                                                  â”‚
   â”‚  DECLARE                                                â”‚
   â”‚    v_booking RECORD;                                    â”‚
   â”‚  BEGIN                                                  â”‚
   â”‚    SELECT * INTO v_booking                             â”‚
   â”‚    FROM bookings WHERE id = p_booking_id;              â”‚
   â”‚                                                         â”‚
   â”‚    IF NOT FOUND THEN                                    â”‚
   â”‚      RAISE EXCEPTION 'Booking not found';              â”‚
   â”‚    END IF;                                              â”‚
   â”‚                                                         â”‚
   â”‚    UPDATE bookings SET                                  â”‚
   â”‚      status = p_new_status,                            â”‚
   â”‚      cancellation_reason = p_cancellation_reason,      â”‚
   â”‚      updated_at = NOW()                                â”‚
   â”‚    WHERE id = p_booking_id;                            â”‚
   â”‚                                                         â”‚
   â”‚    IF p_new_status = 'confirmed' THEN                  â”‚
   â”‚      INSERT INTO notifications (                        â”‚
   â”‚        user_id, type, title, message, related_id       â”‚
   â”‚      ) VALUES (                                         â”‚
   â”‚        v_booking.owner_id,                             â”‚
   â”‚        'booking_confirmed',                            â”‚
   â”‚        'Booking Confirmed!',                           â”‚
   â”‚        'Your booking has been confirmed',              â”‚
   â”‚        p_booking_id                                     â”‚
   â”‚      );                                                 â”‚
   â”‚    END IF;                                              â”‚
   â”‚                                                         â”‚
   â”‚    RETURN TRUE;                                         â”‚
   â”‚  END;                                                   â”‚
   â”‚  $$;                                                    â”‚
   â”‚                                                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ** TIP: It's easier to copy from QUICK_FIX_RUN_NOW.sql **

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ STEP 3: Paste and Run

   1. Paste the SQL in the editor
   2. Click "RUN" button (or press Ctrl+Enter)
   3. Wait for "Success" message
   4. Should see: "Database fixed! Refresh your bookings page now."

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ STEP 4: Test

   1. Go back to: https://petflik.com/bookings
   2. Hard refresh: Ctrl + Shift + R
   3. âœ… Page should load!
   4. âœ… Bookings should appear!
   5. âœ… Pay Now button should work!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ WHAT THIS FIXES:

   âœ… Adds related_id column to notifications
   âœ… Creates update_booking_status function
   âœ… Fixes "Edge Function" error
   âœ… Bookings page will load
   âœ… Accept/Decline buttons will work
   âœ… Pay Now button will work

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ†˜ IF YOU GET AN ERROR:

   Error: "column related_id already exists"
   â†’ Good! It means it's already there, continue anyway

   Error: "table bookings does not exist"
   â†’ You need to run the complete schema first
   â†’ See: database/clean_migration.sql

   Error: "permission denied"
   â†’ Make sure you're logged into the correct Supabase account

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

              â±ï¸ THIS WILL TAKE 2 MINUTES TOTAL

         STEP 1: Open Supabase SQL Editor (30 seconds)
         STEP 2: Copy SQL script (30 seconds)
         STEP 3: Paste and Run (30 seconds)
         STEP 4: Refresh bookings page (30 seconds)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

             ğŸš€ START NOW! Open Supabase SQL Editor:

    https://supabase.com/dashboard/project/zxbfygofxxmfivddwdqt/sql/new

â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

